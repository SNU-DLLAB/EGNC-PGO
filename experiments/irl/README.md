# Incremental Robot Logs (`.IRL`)
Incremental Robot Log files define the data used in an experiment with file format definition provided here.
Existing dataset formats (g2o) represent a batch problem and are not easy to work with in incremental settings. The Incremental Robot Log format makes the temporal sequence of measurements explicit and as such is a better format for incremental SLAM datasets. Additionally, IRL files allow for multi-hypothesis measurements (and in turn outlier measurements) while explicitly defining the correct hypothesis to aid evaluation. However, its multi-hypothesis capacity has not been widely used as riSAM targets primarily the robust SLAM problem.

### Header
The file header provides meta data on the data contained, and consists of static number of elements defined as...
- **Name** - the title or name of the dataset
- **Date Generated** - The date the dataset was generated in `YYYY-MM-DD` format
- **Pose Dimension** - The dimensionality for poses of the file. Either 2 or 3.
- **Problem Linearity** - The linearity of the problem either "linear" or "nonlinear". Linear problems use POINT object (e.g. `gtsam::Point2`, `gtsam::Point3`) as robot poses while nonlinear problems uses POSE objects (e.g. `gtsam::Pose2`, `gtsam::Pose3`) for robot poses. 
- **User String** - User defined string of other relevant info on the dataset.

### Entries
All lines beyond the header should consist of one of the following entries that define the actions/observations of the robot. All entries have the following format:
```
<TAG> <MODES> <CORRECT_MODE> <TAG_SPECIFIC> <MEASUREMENT_1>... <MEASUREMENT_N>
```
Where:
- `MODES [int]`
    - The number of modes for this entry. 
    - There must be exactly MODES number of measurements listed
- `CORRECT_MODE [int]` 
    - The index of the mode that is ground truth correct.
- `TAG_SPECIFIC [?]`
    - Space for tag specific information
- `MEASUREMENT [?/NULL]` 
    - The measurement for this entry specified depending on the Tag or `NULL` indicating the null Hypothesis.
    - `NULL` cannot be the only measurement for a entry

The following Tags are defined.
- `PRIOR`
    - Interpretation: Prior on the first pose
    - Tag Specific: `<POSE_IDX>`
    - Measurement: `<POSE> <COV>`
        - Pose of global dim and covariance which is a Matrix of Corresponding DIM.
    - NULL Hypothesis NOT allowed
- `ODOMETRY`
    - Interpretation: Odometry Measurement from start pose to end pose. (Expect to be sequential with start pose == current pose)
    - Tag Specific: `<START_POSE_IDX> <END_POSE_IDX>`
    - Measurement: `<POSE> <COV>`
        - Pose of global dim and covariance which is a Matrix of Corresponding DIM.
    - NULL Hypothesis NOT allowed
- `LOOP`
    - Interpretation: Loop Closure detected between pose A and pose B
    - Tag Specific: `<POSE_A_IDX>`
    - Measurement: `<POSE_B_IDX> <POSE> <COV>`
        - Pose (POINT or POSE object) of global dim and covariance which is a Matrix of Corresponding DIM.

### Null
The null hypothesis indicates the possibility that none of the measurements for an entry are correct.

### Serialization of Data Types 
Within the entries there are a number of data types that are serialized as follows. Assume all values are floats unless otherwise specified, and all angles are provided in radians

- Pose2 = `X Y THETA`
- Pose3 = `X Y Z Rx Ry Rz` (`gtsam::Rot3::RzRyRx(Rx,Ry,Rz)`)
- MATRIX = Row Major Order (Dim Inferred from Tag and Global Dim)
- Point2 = `X Y`
- Point3 = `X Y Z`

## Result Files
IRL files provide input to the algorithm. Output generated by `run-experiment` is a directory containing...
* `final_values.txt`: Values after the final iteration
* `final_modes.txt`: Modes after the final iteration
* `iteration_times.txt`: Each line is the runtime of the algorithm in milliseconds. 
* `iterations/`
    * `{:06d}_values.txt`: The values after intermediate iterations
    * `{:06d}_modes.txt`: The modes after intermediate iterations

Value and Modes files have the following format.

### Values `.txt` File
Contains pose values for a single step of a solution. Each value is formatted as...
```
<NAME> <IDX> <VALUES>
```
Where `NAME` is one of `{POSE2, POSE3, POINT2, POINT3}`, `IDX` is the variable identifier, and `VALUES` are the serialized datatype as described above.

Each line in the file represents the values for a single hypothesis. Often there is only one line, but if there are multiple, it is the solution for each hypothesis.

### Modes `.txt` File
Contains the mode selected by an algorithm for each entry in the IRL Log. File is space separated and modes are represented by integers.

Each line in the file represents the modes for a single hypothesis. Often there is only one line, but if there are multiple, it is the modes for each hypothesis.

## MISC
This directory houses the c++ (`./include/irl`) and python (`./python`) interfaces for parsing and writing Incremental Robot Log Files.

An example for how to use the python interface can be found in `scripts/g2o-2-irl`

An example for how to use the c++ interface can be found in `run-experiment.cpp`
